<Window x:Class="PowerBIOptimizer.UI.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:PowerBIOptimizer.UI.Controls"
        xmlns:local="clr-namespace:PowerBIOptimizer.UI.Controls"
        Title="Power BI Optimizer" 
        Height="600" 
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Power BI Optimizer" 
                     FontSize="20" 
                     FontWeight="Bold" 
                     Foreground="{StaticResource PrimaryBrush}"
                     Margin="0,0,0,10"/>
            
            <StackPanel Orientation="Horizontal">
                <Button x:Name="RefreshButton" 
                        Click="RefreshButton_Click"
                        Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Resources/Images/refresh.png" 
                               Width="16" 
                               Height="16" 
                               Margin="0,0,5,0"/>
                        <TextBlock Text="Refresh"/>
                    </StackPanel>
                </Button>
                
                <TextBlock x:Name="StatusText" 
                          VerticalAlignment="Center"
                          Foreground="{StaticResource SecondaryBrush}"/>
            </StackPanel>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Queries Panel -->
            <GroupBox Header="Queries" 
                     Grid.Column="0" 
                     Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Search Box -->
                    <TextBox Grid.Row="0" 
                             Margin="5"
                             Name="QuerySearchBox"
                             TextChanged="SearchBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Grid>
                                                <TextBox Text="{Binding Path=Text, RelativeSource={RelativeSource TemplatedParent}, 
                                                         UpdateSourceTrigger=PropertyChanged}"
                                                         Background="Transparent"
                                                         Panel.ZIndex="2"/>
                                                <TextBlock Text="Search queries..." 
                                                         Foreground="Gray"
                                                         Margin="5,3,0,0"
                                                         Panel.ZIndex="1">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                             AncestorType=TextBox}}" Value="">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- Queries List -->
                    <controls:QueryListControl x:Name="QueryListControl"
                                            Grid.Row="1"
                                            ItemSelected="QueriesList_ItemSelected"
                                            OptimizeRequested="QueriesList_OptimizeRequested"
                                            ViewDetailsRequested="QueriesList_ViewDetailsRequested"
                                            CopyRequested="QueriesList_CopyRequested"/>
                </Grid>
            </GroupBox>

            <!-- Measures Panel -->
            <GroupBox Header="Measures" 
                     Grid.Column="1" 
                     Margin="5,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Search Box -->
                    <TextBox Grid.Row="0" 
                             Margin="5"
                             Name="MeasureSearchBox"
                             TextChanged="SearchBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Grid>
                                                <TextBox Text="{Binding Path=Text, RelativeSource={RelativeSource TemplatedParent}, 
                                                         UpdateSourceTrigger=PropertyChanged}"
                                                         Background="Transparent"
                                                         Panel.ZIndex="2"/>
                                                <TextBlock Text="Search measures..." 
                                                         Foreground="Gray"
                                                         Margin="5,3,0,0"
                                                         Panel.ZIndex="1">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Mode=FindAncestor, 
                                                                             AncestorType=TextBox}}" Value="">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- Measures List -->
                    <controls:QueryListControl x:Name="MeasureListControl"
                                            Grid.Row="1"
                                            ItemSelected="MeasuresList_ItemSelected"
                                            OptimizeRequested="MeasuresList_OptimizeRequested"
                                            ViewDetailsRequested="MeasuresList_ViewDetailsRequested"
                                            CopyRequested="MeasuresList_CopyRequested"/>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Footer -->
        <StatusBar Grid.Row="2" 
                  Background="Transparent" 
                  Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock x:Name="FooterText" 
                          Text="Ready"
                          Foreground="{StaticResource SecondaryBrush}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Connected Files: "/>
                    <TextBlock x:Name="FileCountText" 
                             Text="0" 
                             Margin="5,0,0,0"
                             FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
